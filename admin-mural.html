<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Mural Escolar</title>
</head>
    <body>
<section class="adm-section">
    <h2>Painel Admin – Mural Escolar</h2>

    <!-- FORMULÁRIO -->
    <div class="adm-form">
        <input id="titulo" type="text" placeholder="Título do aviso">
        <textarea id="mensagem" placeholder="Mensagem"></textarea>

        <label>Cor da faixa lateral:</label>
        <select id="cor">
            <option value="azul">Azul</option>
            <option value="vermelho">Vermelho</option>
            <option value="amarelo">Amarelo</option>
        </select>

        <input id="linkOpcional" type="text" placeholder="Link (opcional)">

        <button id="btnPublicar">Publicar Aviso</button>
    </div>

    <h3>Avisos Publicados</h3>
    <div id="listaAvisos"></div>
</section>

<style>
    .adm-section {
        max-width: 700px;
        margin: 40px auto;
        padding: 20px;
        font-family: Poppins, sans-serif;
    }

    .adm-form {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 40px;
    }

    .adm-form input, .adm-form textarea, .adm-form select {
        padding: 12px;
        border: 1px solid #ccc;
        border-radius: 8px;
        font-size: 15px;
    }

    .adm-form button {
        background: #4a2db6;
        color: white;
        border: none;
        padding: 12px;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
    }

    .cardAdm {
        display: flex;
        align-items: center;
        gap: 15px;
        background: white;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        position: relative;
    }

    .faixa {
        width: 8px;
        height: 100%;
        border-radius: 8px;
        position: absolute;
        left: 0;
        top: 0;
    }

    .azul { background: #007BFF; }
    .vermelho { background: #FF3B3B; }
    .amarelo { background: #FFC107; }

    .info {
        margin-left: 15px;
        flex: 1;
    }

    .cardAdm button {
        background: #ff3b3b;
        border: none;
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
    }

</style>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyAAkBk52aOoo9IZsbEIHRBwOyIZ66Mbhx0",
        authDomain: "mural-af763.firebaseapp.com",
        projectId: "mural-af763",
        storageBucket: "mural-af763.firebasestorage.app",
        messagingSenderId: "418040841130",
        appId: "1:418040841130:web:9d96121172ccede5dea1d3",
        measurementId: "G-W4QTRV47TM",
        databaseURL: "https://mural-af763-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const btn = document.getElementById("btnPublicar");
    const lista = document.getElementById("listaAvisos");

    // Publicar aviso
    btn.addEventListener("click", () => {
        const titulo = document.getElementById("titulo").value.trim();
        const mensagem = document.getElementById("mensagem").value.trim();
        const cor = document.getElementById("cor").value;
        const linkOpcional = document.getElementById("linkOpcional").value.trim();

        if (!titulo || !mensagem) {
            alert("Preencha pelo menos título e mensagem!");
            return;
        }

        push(ref(db, "avisos"), {
            titulo,
            mensagem,
            cor,
            link: linkOpcional || null,
            data: Date.now()
        });

        alert("Publicado com sucesso!");

        document.getElementById("titulo").value = "";
        document.getElementById("mensagem").value = "";
        document.getElementById("linkOpcional").value = "";
        document.getElementById("cor").value = "azul";
    });

    // Carregar avisos na lista ADM
    onValue(ref(db, "avisos"), (snapshot) => {
        lista.innerHTML = "";
        const dados = snapshot.val();
        if (!dados) {
            lista.innerHTML = "<p>Nenhum aviso publicado ainda.</p>";
            return;
        }

        Object.entries(dados).forEach(([id, aviso]) => {
            const div = document.createElement("div");
            div.className = "cardAdm";
            div.innerHTML = `
                <div class="faixa ${aviso.cor}"></div>

                <div class="info">
                    <h4>${aviso.titulo}</h4>
                    <p>${aviso.mensagem}</p>
                    ${aviso.link ? `<a href="${aviso.link}" target="_blank">Abrir link</a>` : ""}
                </div>

                <button onclick="excluirAviso('${id}')">Excluir</button>
            `;

            lista.appendChild(div);
        });
    });

    // Excluir aviso
    window.excluirAviso = (id) => {
        if (confirm("Tem certeza que deseja excluir?")) {
            remove(ref(db, "avisos/" + id));
        }
    };
</script>
</body>
</html>
